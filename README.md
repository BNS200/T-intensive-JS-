# 1. Ролевая модель системы
## Определение ролей и их назначение
В системе предусмотрены следующие роли пользователей:
- Владелец доски 
  - Создатель доски, обладает максимальными правами
  - Может удалять доску полностью
  - Назначает администраторов доски
  - Может передавать права владения другому пользователю
  - Имеет доступ ко всем функциям управления

- Администратор доски 
  - Назначается владельцем доски
  - Управляет участниками доски (добавление, удаление, изменение ролей)
  - Настраивает структуру колонок и workflow
  - Может создавать, редактировать и удалять любые задачи на доске
  - Имеет права на архивацию доски
  - Не может удалить доску полностью

- Участник
  - Стандартный участник рабочего процесса
  - Может создавать новые задачи
  - Редактировать задачи, где назначен исполнителем
  - Перемещать задачи между колонками в соответствии с workflow
  - Добавлять комментарии к задачам
  - Не может управлять участниками или настройками доски

- Наблюдатель 
  - Имеет доступ только для просмотра
  - Может просматривать доску, задачи и комментарии
  - Не может вносить изменения, создавать задачи или комментировать
  - Идеальная роль для stakeholders и менеджеров

- Гость
  - Временный доступ по пригласительной ссылке
  - Ограниченный просмотр (только публичные доски или конкретные доски)
  - Срок действия доступа ограничен
  - Минимальные права для ознакомления

## Механизм назначения прав
Система назначения прав работает по следующим принципам:
- Автоматическое назначение: Создатель доски автоматически получает роль "Владелец"
- Наследование прав: Пользователи могут наследовать права через групповую принадлежность
- Каскадное изменение: При изменении роли пользователя права автоматически обновляются
- Временные ограничения: Гостевой доступ имеет ограниченный срок действия
- Ручное управление: Владелец и администраторы могут вручную назначать роли участникам

# 2. Статусная модель сущностей
Карточка задачи проходит через следующий цикл:
- Backlog
  - Начальное состояние для новых задач
  - Задачи ожидают планирования и приоритизации
  - Можно редактировать, но нельзя назначать исполнителя
  - Переход в "To Do" означает готовность к работе

- To Do 
  - Задачи запланированы к выполнению
  - Можно назначать исполнителей
  - Определяются сроки и приоритеты
  - Переход в "In Progress" означает начало работы

- In Progress 
  - Активная стадия выполнения задачи
  - Исполнитель работает над задачей
  - Фиксируется затраченное время
  - Обратный переход требует пояснения в комментарии

- Review 
  - Задача завершена исполнителем и ожидает проверки
  - Требуется ревью от ответственного лица
  - Возможен возврат на доработку с комментариями
  - Одобрение переводит задачу в тестирование

- Testing 
  - Функциональность проверяется на соответствие требованиям
  - Выявляются и фиксируются дефекты
  - Тестировщик подтверждает качество выполнения
  - Успешное тестирование ведет к завершению

- Done
  - Финальный статус успешно завершенной задачи
  - Задача готова к использованию
  - Автоматическая архивация через установленное время
  - Может быть reopened при необходимости доработок

- Cancelled 
  - Альтернативный финальный статус
  - Задача отменена по различным причинам
  - Обязательное указание причины отмены в комментарии
  - Статистически учитывается отдельно от выполненных задач

Дополнительные сущности со статусной моделью:
- Доска
  - Active - активная рабочая доска
  - Template - шаблон для создания новых досок
- Пользователь
  - Active - активный пользователь системы
  - Inactive - временно неактивный (сохранены данные)
  - Suspended - заблокированный за нарушения

- Команда
  - Active - активная команда
  - Inactive - неактивная команда

# 3. Модели данных и их состояния

Модели бэкенда (серверная часть)

Модели бэкенда ориентированы на целостность данных и эффективное хранение:

User Entity - содержит полную информацию о пользователе включая хеш пароля, настройки и метаданные активности

Board Entity - хранит основные данные доски, настройки видимости и конфигурацию workflow

BoardMember Entity - связующая сущность для управления правами доступа пользователей к доскам

Task Entity - основная сущность задачи с полями для tracking прогресса, назначения и временных меток

Status Entity - справочник статусов с настройками визуализации и бизнес-правил

DTO (Data Transfer Objects)

DTO служат контрактами для обмена данными между фронтендом и бэкендом:

TaskDTO - оптимизирован для API, содержит связанные данные (исполнитель, создатель, метки)

BoardDTO - передает структуру доски с колонками и базовой информацией

UserDTO - безопасное представление пользователя без чувствительных данных

Модели фронтенда (клиентская часть)

Модели фронтенда оптимизированы для пользовательского интерфейса и реактивности:

Task Model - упрощенная модель с UI-состояниями (dragging, editing, loading)

Board State - агрегированное состояние доски для эффективного рендеринга

UI State - управление модальными окнами, фильтрами и настройками отображения

Состояния данных:
- Loading - загрузка с сервера
- Ready - данные загружены и готовы к использованию
- Updating - выполняется обновление
- Error - ошибка при загрузке или обновлении

# 4. Система валидации

## 1. Валидация прав доступа

- Пользователь должен быть участником доски для любых операций
- Гости имеют доступ только к публичным доскам по временной ссылке
- Проверка срока действия гостевого доступа
- Валидация роли пользователя в контексте конкретной доски

### Проверка операционных прав:
- Создание задач: участник, администратор, владелец
- Редактирование задач: создатель задачи, администратор, владелец
- Удаление задач: администратор, владелец
- Управление участниками: администратор, владелец
- Настройка доски: администратор, владелец

### Контекстно-зависимые проверки
В зависимости от статуса задачи:
- Задачи в статусе "Done" могут редактироваться только администраторами
- Задачи в статусе "Cancelled" требуют особых прав для восстановления
- Перемещение из "In Progress" назад требует комментария

## 2. Валидация workflow переходов

Разрешенные переходы статусов:
- Backlog ->To Do (любой участник)
- To Do -> In Progress (исполнитель или выше)
- In Progress -> Review (исполнитель)
- Review -> Testing (ревьювер)
- Testing -> Done (тестировщик)
- Testing -> Review (тестировщик при обнаружении проблем)
- Любой статус -> Cancelled (администратор и владелец с комментарием)
- Done -> To Do (только администратор)

## 3. Валидация данных

### Заголовок задачи
- Обязательное поле
- Минимальная длина: 3 символа
- Максимальная длина: 255 символов
- Запрещены специальные символы: < > & 
- Уникальность в рамках доски (опционально)

### Описание задачи
- Максимальная длина: 5000 символов

## 4. Валидация состояний 

### Ссылочная целостность
- Исполнитель задачи должен существовать в системе
- Доска задачи должна существовать и быть активной
- Статус задачи должен существовать в workflow доски
- Родительские задачи должны существовать для подзадач

### Временная целостность
- Дата создания не может быть позже даты обновления
- Дата завершения не может быть раньше даты создания

### Конфликты параллельного редактирования
- Проверка версии данных при обновлении
- Обнаружение и разрешение конфликтующих изменений
- Уведомление пользователей о параллельных правках

## 5. Валидация системных ограничений

Лимиты API:
- Максимум 100 запросов в минуту на пользователя
- Максимум 10 одновременных WebSocket соединений

## 6. Обработка и эскалация ошибок

### Уровень 1 - Предупреждения:
- Незначительные нарушения валидации
- Автоматическое исправление или предложения
- Логирование для аналитики
- Пример: незначительное превышение лимитов

### Уровень 2 - Ошибки пользователя:
- Нарушения бизнес-правил
- Требуют вмешательства пользователя
- Четкие сообщения об ошибках
- Пример: недостаточно прав для операции

### Уровень 3 - Системные ошибки:
- Критические нарушения целостности
- Требуют вмешательства администратора
- Автоматическое уведомление поддержки
- Пример: потеря ссылочной целостности
